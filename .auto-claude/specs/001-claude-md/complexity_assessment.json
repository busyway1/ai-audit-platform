{
  "complexity": "complex",
  "workflow_type": "feature",
  "confidence": 0.90,
  "reasoning": "This is a large-scale feature implementation with 25+ files across frontend (React) and backend (Python) services, involving LangGraph agent orchestration, MCP server integration, real-time SSE streaming, and new architectural patterns (HITL interrupt, agent factory). External research required for LangGraph patterns and MCP client implementation.",

  "analysis": {
    "scope": {
      "estimated_files": 28,
      "estimated_services": 2,
      "is_cross_cutting": true,
      "notes": "Frontend: 12 files (4 stores, 8 components). Backend: 16 files (3 agents, 6 graph nodes, 3 API routes, 2 factories, 2 state updates). Cross-cutting: Frontend UI must sync with backend agent states and SSE streams."
    },
    "integrations": {
      "external_services": ["LangGraph", "MCP servers (mcp-rag, mcp-excel-processor)", "Supabase"],
      "new_dependencies": ["langgraph.types (interrupt)", "SSE EventSource"],
      "research_needed": true,
      "notes": "LangGraph HITL interrupt pattern requires research. MCP client integration for external tool calls needs API documentation review. SSE reconnection logic needs robust implementation."
    },
    "infrastructure": {
      "docker_changes": false,
      "database_changes": false,
      "config_changes": true,
      "notes": "No Docker changes in this project (DB migrations in separate audit-mcp-suite). New .env variables needed for SSE endpoints and MCP server URLs. Database schema changes are done in the other project."
    },
    "knowledge": {
      "patterns_exist": true,
      "research_required": true,
      "unfamiliar_tech": ["LangGraph interrupt/checkpoint patterns", "Staff agent factory pattern", "Multi-agent conversation memory management"],
      "notes": "Zustand store patterns exist (useChatStore, useTaskStore). LangGraph state exists (AuditState, TaskState). However, HITL interrupt flow, agent factory with dynamic spawning, and conversation memory summarization are new patterns requiring research."
    },
    "risk": {
      "level": "medium",
      "concerns": [
        "Agent orchestration complexity - Partner→Manager→Staff hierarchy",
        "Real-time SSE streaming reliability and reconnection",
        "HITL interrupt flow state management",
        "Token counting and memory summarization accuracy",
        "Task hierarchy tree performance with deep nesting"
      ],
      "notes": "Core audit workflow depends on correct agent coordination. SSE failure could break user experience. HITL requires careful interrupt/resume state handling."
    }
  },

  "task_breakdown": {
    "ai_audit_frontend": {
      "worktree_1_project_ui": ["FE-6.1", "FE-6.2", "FE-6.3", "FE-6.4"],
      "worktree_2_ega_task_ui": ["FE-7.1", "FE-7.2", "FE-7.3"],
      "worktree_3_streaming": ["FE-8.1", "FE-8.2"],
      "worktree_4_hitl_ui": ["FE-9.1", "FE-9.2", "FE-9.3"]
    },
    "ai_audit_backend": {
      "worktree_5_agents": ["BE-10.1", "BE-10.2", "BE-11.1", "BE-12.1", "BE-12.2"],
      "worktree_6_graph_nodes": ["BE-13.1", "BE-13.2", "BE-13.3", "BE-14.1", "BE-14.2", "BE-14.3", "BE-15.1", "BE-15.2", "BE-15.3"]
    },
    "total_tasks": 25,
    "priority_p0_tasks": ["FE-6.1", "FE-6.2", "FE-6.3", "FE-6.4", "FE-8.1", "FE-8.2", "BE-10.1", "BE-10.2", "BE-11.1", "BE-13.1", "BE-13.2", "BE-13.3", "BE-14.1", "BE-14.2", "BE-14.3"],
    "priority_p1_tasks": ["FE-7.1", "FE-7.2", "FE-7.3", "FE-9.1", "FE-9.2", "FE-9.3", "BE-12.1", "BE-12.2", "BE-15.1", "BE-15.2", "BE-15.3"]
  },

  "recommended_phases": [
    "discovery",
    "requirements",
    "research",
    "context",
    "spec_writing",
    "self_critique",
    "planning",
    "validation"
  ],

  "flags": {
    "needs_research": true,
    "needs_self_critique": true,
    "needs_infrastructure_setup": false,
    "has_external_dependency": true,
    "requires_parallel_worktrees": true
  },

  "research_topics": [
    {
      "topic": "LangGraph interrupt() and checkpoint patterns",
      "reason": "HITL interrupt flow requires understanding how to pause/resume graph execution",
      "priority": "high"
    },
    {
      "topic": "MCP server client implementation in Python",
      "reason": "Staff agents need to call MCP tools (mcp-excel-processor, mcp-rag)",
      "priority": "high"
    },
    {
      "topic": "SSE EventSource reconnection best practices",
      "reason": "useStreamingChat hook needs robust reconnection logic",
      "priority": "medium"
    },
    {
      "topic": "Claude Haiku token counting and summarization",
      "reason": "Memory manager needs to trigger summarization at 8000 token threshold",
      "priority": "medium"
    }
  ],

  "validation_recommendations": {
    "risk_level": "high",
    "skip_validation": false,
    "minimal_mode": false,
    "test_types_required": ["unit", "integration", "e2e"],
    "security_scan_required": true,
    "staging_deployment_required": false,
    "reasoning": "Multi-agent system with complex orchestration requires comprehensive testing. Unit tests for individual nodes/agents, integration tests for agent-to-agent communication, and E2E tests for full audit workflow. Security scan needed for API endpoints handling audit data. No staging deployment required as no external infrastructure dependencies in this project."
  },

  "dependencies": {
    "external_project_dependency": {
      "project": "audit-mcp-suite",
      "required_tasks": ["MCP-1.1 (DB Schema)", "MCP-2.1~2.6 (Excel Processor)"],
      "reason": "Frontend and backend rely on database tables and MCP server created in audit-mcp-suite project",
      "blocking": true
    },
    "internal_task_dependencies": [
      {
        "task": "FE-6.1 (Project Store)",
        "blocks": ["FE-6.2", "FE-6.3", "FE-6.4", "FE-7.1", "FE-7.2", "FE-7.3"]
      },
      {
        "task": "BE-14.2 (State Definition)",
        "blocks": ["BE-14.1", "BE-14.3", "BE-13.1", "BE-13.2", "BE-13.3"]
      }
    ]
  },

  "created_at": "2026-01-08T12:00:00Z"
}
