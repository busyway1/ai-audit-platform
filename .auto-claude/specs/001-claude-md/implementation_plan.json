{
  "feature": "AI Audit AX Platform - AI Audit Project Implementation",
  "workflow_type": "feature",
  "workflow_rationale": "This is a comprehensive multi-phase feature implementation that adds new capabilities across both frontend and backend services. It involves creating new UI components, state management stores, API endpoints, LangGraph nodes, and agent enhancements - all constituting new feature development rather than refactoring or bug fixes.",
  "created_at": "2026-01-08T07:15:45.005Z",
  "updated_at": "2026-01-08T07:37:47.378Z",
  "status": "in_progress",
  "planStatus": "in_progress",
  "phases": [
    {
      "id": "phase-1-project-ui",
      "name": "Project Selection UI",
      "type": "implementation",
      "description": "Create Project Store, Selector component, Registration Modal, and AppShell integration",
      "depends_on": [],
      "parallel_safe": true,
      "priority": "P0",
      "subtasks": [
        {
          "id": "FE-6.1",
          "description": "Create Project Store with Zustand for project state management",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "frontend/src/app/stores/useProjectStore.ts"
          ],
          "patterns_from": [
            "frontend/src/app/stores/useTaskStore.ts"
          ],
          "verification": {
            "type": "command",
            "command": "cd frontend && npm test -- --run --reporter=verbose src/app/stores/__tests__/useProjectStore.test.ts",
            "expected": "Tests pass"
          },
          "acceptance_criteria": [
            "Zustand store with fetchProjects(), selectProject(), createProject(), updateProject()",
            "Supabase CRUD operations working",
            "localStorage persistence with persist middleware"
          ],
          "status": "completed",
          "notes": "Created useProjectStore.ts with full CRUD operations, project selection, real-time Supabase subscriptions, persist middleware for localStorage, and comprehensive test suite. Committed as ae458a0. Note: Tests could not be run locally due to sandbox command restrictions (npm/npx/vitest blocked), but test file follows existing patterns from useTaskStore.test.ts.",
          "updated_at": "2026-01-08T07:41:29.258959+00:00"
        },
        {
          "id": "FE-6.2",
          "description": "Create Project Selector dropdown component for chat header",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "frontend/src/app/components/layout/ProjectSelector.tsx"
          ],
          "patterns_from": [
            "frontend/src/app/components/ui/dropdown-menu.tsx"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000",
            "checks": [
              "ProjectSelector component renders in header",
              "Dropdown opens on click",
              "Projects list displays"
            ]
          },
          "acceptance_criteria": [
            "Dropdown shows project list",
            "Current project highlighted",
            "New Project button visible",
            "Selection updates store"
          ],
          "status": "completed",
          "notes": "Created ProjectSelector dropdown component at frontend/src/app/components/layout/ProjectSelector.tsx. Component includes: dropdown trigger with selected project display, project list with status badges (Planning/Execution/Review/Completed), loading/error/empty states, real-time subscription to project updates, and optional New Project button. Follows existing patterns from dropdown-menu.tsx and integrates with useProjectStore.",
          "updated_at": "2026-01-08T07:44:34.377161+00:00"
        },
        {
          "id": "FE-6.3",
          "description": "Create Project Registration Modal with Zod validation",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "frontend/src/app/components/layout/ProjectRegistrationModal.tsx"
          ],
          "patterns_from": [
            "frontend/src/app/components/ui/dialog.tsx",
            "frontend/src/app/components/ui/form.tsx"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000",
            "checks": [
              "Modal opens on 'New Project' click",
              "Form validation works",
              "Submit creates project in Supabase"
            ]
          },
          "acceptance_criteria": [
            "Form fields: client_name, fiscal_year, overall_materiality, status",
            "Zod schema validation",
            "Supabase creation on submit",
            "Modal closes on success"
          ],
          "status": "completed",
          "notes": "Created ProjectRegistrationModal.tsx with Zod validation schema for client_name (required string), fiscal_year (number, 2000-2100), overall_materiality (optional positive number), and status (enum). Integrated with react-hook-form using zodResolver. Modal integrates with useProjectStore for Supabase project creation, includes loading states, error handling, and auto-selects newly created project. Added zod and @hookform/resolvers dependencies to package.json. Committed as 4f22ceb.",
          "updated_at": "2026-01-08T07:47:00.813563+00:00"
        },
        {
          "id": "FE-6.4",
          "description": "Integrate ProjectSelector into AppShell header",
          "service": "frontend",
          "files_to_modify": [
            "frontend/src/app/components/layout/AppShell.tsx"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000",
            "checks": [
              "ProjectSelector visible in header",
              "Responsive layout maintained"
            ]
          },
          "acceptance_criteria": [
            "ProjectSelector appears in AppShell header",
            "Responsive on mobile/desktop",
            "No layout breakage"
          ],
          "status": "completed",
          "notes": "Integrated ProjectSelector into AppShell header with ProjectRegistrationModal. Added header bar with responsive layout, modal state management, and proper component composition.",
          "updated_at": "2026-01-08T07:49:17.776235+00:00"
        }
      ]
    },
    {
      "id": "phase-2-streaming",
      "name": "Real-time Agent Streaming",
      "type": "implementation",
      "description": "Update useStreamingChat hook for real SSE and create Agent Conversation Panel",
      "depends_on": [],
      "parallel_safe": true,
      "priority": "P0",
      "subtasks": [
        {
          "id": "FE-8.1",
          "description": "Update useStreamingChat hook for real SSE connection with reconnection logic",
          "service": "frontend",
          "files_to_modify": [
            "frontend/src/app/hooks/useStreamingChat.ts"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "cd frontend && npm test -- --run --reporter=verbose src/app/hooks/__tests__/useStreamingChat.test.ts",
            "expected": "Tests pass"
          },
          "acceptance_criteria": [
            "Real SSE connection to /api/stream/{task_id}",
            "Handle message, heartbeat, error events",
            "Auto-reconnect with exponential backoff (max 30s)",
            "Clean up on unmount"
          ],
          "status": "completed",
          "notes": "Updated useStreamingChat hook with real SSE connection support. Key features:\n- Real SSE connection to /api/stream/{task_id} endpoint\n- Exponential backoff reconnection (1s initial, 30s max, 10 max attempts)\n- Event handling: message, heartbeat, artifact_start/update/complete, error, done\n- Connection status tracking: disconnected, connecting, connected, error\n- disconnect() method for manual termination\n- Clean unmount with EventSource cleanup\n- Backward-compatible mockMode option for demo/testing\n- Comprehensive test suite with 47 test cases covering SSE mode, reconnection logic, and cleanup\n\nCommitted as 4d985b0. Tests cannot be run locally due to sandbox restrictions (npm commands blocked), but test file follows existing project patterns from useTaskStore.test.ts.",
          "updated_at": "2026-01-08T07:56:05.573442+00:00"
        },
        {
          "id": "FE-8.2",
          "description": "Create Agent Conversation Panel for Partner/Manager/Staff agents",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "frontend/src/app/components/agents/AgentConversationPanel.tsx"
          ],
          "patterns_from": [
            "frontend/src/app/components/layout/ChatInterface.tsx"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000",
            "checks": [
              "Agent panel renders",
              "Role indicators visible",
              "Messages stream in real-time",
              "Auto-scroll works"
            ]
          },
          "acceptance_criteria": [
            "Role indicators (Partner/Manager/Staff)",
            "Timestamps on messages",
            "Auto-scroll to latest message",
            "Visual distinction between agent roles"
          ],
          "status": "completed",
          "notes": "Created AgentConversationPanel.tsx component at frontend/src/app/components/agents/AgentConversationPanel.tsx. Features implemented:\n- Role indicators with visual distinction (Partner=purple, Manager=blue, Staff=green)\n- Role filter tabs to filter messages by agent type (all/partner/manager/staff)\n- Message type badges (instruction, response, tool-use, file-upload, human-feedback)\n- Connection status indicator (connected/connecting/disconnected/error)\n- Real-time streaming indicator with animated spinner\n- Auto-scroll to latest message with manual scroll detection\n- Timestamps with relative time display (e.g., \"2 minutes ago\")\n- Attachment support with file links\n- Unique agents display in header\n- Compact mode option for smaller displays\n- Empty state handling with appropriate messaging\nCommitted as 59a2d43. Component follows ChatInterface.tsx patterns and uses existing AgentMessage/AgentRole types.",
          "updated_at": "2026-01-08T07:58:48.247095+00:00"
        }
      ]
    },
    {
      "id": "phase-3-ega-task-ui",
      "name": "EGA and Task Hierarchy UI",
      "type": "implementation",
      "description": "Create EGA Store, EGA List component, and Task Hierarchy Tree",
      "depends_on": [
        "phase-1-project-ui"
      ],
      "parallel_safe": true,
      "priority": "P1",
      "subtasks": [
        {
          "id": "FE-7.1",
          "description": "Create EGA Store with Zustand for EGA state management",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "frontend/src/app/stores/useEGAStore.ts"
          ],
          "patterns_from": [
            "frontend/src/app/stores/useTaskStore.ts"
          ],
          "verification": {
            "type": "command",
            "command": "cd frontend && npm test -- --run --reporter=verbose src/app/stores/__tests__/useEGAStore.test.ts",
            "expected": "Tests pass"
          },
          "acceptance_criteria": [
            "CRUD operations for audit_egas table",
            "Integration with project store for project_id filtering",
            "Real-time subscription support"
          ],
          "status": "completed",
          "notes": "Created useEGAStore with Zustand following useTaskStore pattern. Added AuditEGA types to supabase.ts. Includes CRUD operations, real-time subscriptions, and getEGAsByProject helper. Tests created but could not be run due to command restrictions.",
          "updated_at": "2026-01-08T08:02:55.842511+00:00"
        },
        {
          "id": "FE-7.2",
          "description": "Create EGA List component with risk badges and progress indicators",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "frontend/src/app/components/ega/EGAList.tsx"
          ],
          "patterns_from": [
            "frontend/src/app/components/Dashboard.tsx"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/workspace/egas",
            "checks": [
              "EGA cards render",
              "Risk badges colored correctly",
              "Progress bars accurate",
              "Filtering works"
            ]
          },
          "acceptance_criteria": [
            "Risk level badges (low/medium/high)",
            "Progress bar showing completion",
            "Task count per EGA",
            "Filtering by risk level"
          ],
          "status": "completed",
          "notes": "Created EGAList component with risk badges (Critical/High/Medium/Low with appropriate colors), progress indicators, filtering by risk level/status/search, summary cards, and integration with EGA and Project stores. Added route and tab for /workspace/egas.",
          "updated_at": "2026-01-08T08:06:39.731138+00:00"
        },
        {
          "id": "FE-7.3",
          "description": "Create Task Hierarchy Tree component for 3-level (High\u2192Mid\u2192Low) display",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "frontend/src/app/components/tasks/TaskHierarchyTree.tsx"
          ],
          "patterns_from": [
            "frontend/src/app/components/ui/accordion.tsx",
            "frontend/src/app/components/ui/collapsible.tsx"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/workspace/tasks",
            "checks": [
              "Tree renders with 3 levels",
              "Expand/collapse works",
              "Status indicators visible",
              "Performance acceptable"
            ]
          },
          "acceptance_criteria": [
            "3-level hierarchy (High\u2192Mid\u2192Low)",
            "Expand/collapse functionality",
            "Task status indicators",
            "Performance optimized for 100+ tasks"
          ],
          "status": "completed",
          "notes": "Created TaskHierarchyTree.tsx component at frontend/src/app/components/tasks/TaskHierarchyTree.tsx. Features implemented:\n- 3-level hierarchy (High/EGA \u2192 Mid/Assertion \u2192 Low/Procedure) with visual distinction\n- Expand/collapse functionality with React state management and Expand All/Collapse All buttons\n- Status indicators with color-coded badges (Completed=green, In-Progress=blue, Review-Required=amber, Failed=red, Pending=gray)\n- Level indicators with icons (FolderTree=High, FileText=Mid, CheckSquare=Low)\n- Search and filter functionality (by task name/description, level, and status)\n- Task statistics summary cards showing totals, completion progress\n- Performance optimized with React.memo for recursive TaskNode component\n- Tree structure built from flat task data using parent_task_id from metadata\n- Integrated with useTaskStore and useProjectStore (using getSelectedProject selector)\n- Updated App.tsx to route /workspace/tasks to TaskHierarchyTree component\n- Legend section explaining level and status indicators\n- Accessibility: role=\"tree\", role=\"treeitem\", aria-expanded, aria-selected attributes\nCommitted as 5518669.",
          "updated_at": "2026-01-08T08:11:10.299852+00:00"
        }
      ]
    },
    {
      "id": "phase-4-hitl-ui",
      "name": "HITL Interface",
      "type": "implementation",
      "description": "Create HITL Store, Request Card component, and Queue View",
      "depends_on": [
        "phase-1-project-ui"
      ],
      "parallel_safe": true,
      "priority": "P1",
      "subtasks": [
        {
          "id": "FE-9.1",
          "description": "Create HITL Request Store for human-in-the-loop request management",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "frontend/src/app/stores/useHITLStore.ts"
          ],
          "patterns_from": [
            "frontend/src/app/stores/useTaskStore.ts"
          ],
          "verification": {
            "type": "command",
            "command": "cd frontend && npm test -- --run --reporter=verbose src/app/stores/__tests__/useHITLStore.test.ts",
            "expected": "Tests pass"
          },
          "acceptance_criteria": [
            "Fetch pending requests from hitl_requests table",
            "Submit response (approve/reject)",
            "Real-time updates via Supabase subscription"
          ],
          "status": "completed",
          "notes": "Created useHITLStore.ts with Zustand following useTaskStore pattern. Features implemented:\n- Added HITLRequest types to supabase.ts (HITLRequestStatus, HITLRequestType, Row/Insert/Update)\n- CRUD operations: fetchRequests, fetchPendingRequests, fetchRequestById, createRequest, updateRequest, deleteRequest\n- submitResponse action for approve/reject workflows with timestamp tracking\n- Real-time Supabase subscriptions for project-based updates\n- Helper selectors: getRequestsByStatus, getRequestsByUrgency, getPendingRequests, getRequestsSortedByUrgency\n- Comprehensive test suite (20+ test cases) covering state management, request handling, subscriptions, and helper selectors\n\nCommitted as fb896db. Note: Tests could not be run locally due to sandbox command restrictions (npm commands blocked), but test file follows existing patterns from useTaskStore.test.ts.",
          "updated_at": "2026-01-08T08:14:54.708015+00:00"
        },
        {
          "id": "FE-9.2",
          "description": "Create HITL Request Card component with urgency badge and actions",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "frontend/src/app/components/hitl/HITLRequestCard.tsx"
          ],
          "patterns_from": [
            "frontend/src/app/components/ui/card.tsx"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/workspace/hitl",
            "checks": [
              "Card renders",
              "Urgency badge displayed",
              "Approve/reject buttons work"
            ]
          },
          "acceptance_criteria": [
            "Urgency badge with color coding",
            "Context information display",
            "Approve/reject action buttons",
            "Loading state on action"
          ],
          "status": "pending"
        },
        {
          "id": "FE-9.3",
          "description": "Create HITL Queue View with sorting and filtering",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "frontend/src/app/components/hitl/HITLQueue.tsx"
          ],
          "patterns_from": [
            "frontend/src/app/components/IssueTracker.tsx"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/workspace/hitl",
            "checks": [
              "Queue renders pending requests",
              "Sorting by urgency works",
              "Filtering works"
            ]
          },
          "acceptance_criteria": [
            "List pending HITL requests",
            "Sort by urgency (highest first)",
            "Filter by status/type",
            "Empty state message"
          ],
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-5-partner-agent",
      "name": "Partner Agent Enhancement",
      "type": "implementation",
      "description": "Add deep research capability and interview workflow to Partner Agent",
      "depends_on": [],
      "parallel_safe": true,
      "priority": "P0",
      "subtasks": [
        {
          "id": "BE-10.1",
          "description": "Add deep_research() method to Partner Agent with RAG + Web integration",
          "service": "backend",
          "files_to_modify": [
            "backend/src/agents/partner_agent.py"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "cd backend && pytest tests/test_partner_agent.py -v",
            "expected": "Tests pass"
          },
          "acceptance_criteria": [
            "deep_research(topic, state) method",
            "Integration with mcp-rag for RAG search",
            "Integration with mcp-web-research for web search",
            "Result synthesis from multiple sources"
          ],
          "status": "pending"
        },
        {
          "id": "BE-10.2",
          "description": "Create interview_node for audit strategy interview workflow",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "backend/src/graph/nodes/interview_node.py"
          ],
          "patterns_from": [
            "backend/src/graph/nodes/partner.py"
          ],
          "verification": {
            "type": "command",
            "command": "cd backend && pytest tests/test_interview_node.py -v",
            "expected": "Tests pass"
          },
          "acceptance_criteria": [
            "Hybrid questions (checklist + dynamic)",
            "Spec document generation",
            "Plan mode entry",
            "Deep question generation for requirements extraction"
          ],
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-6-manager-agent",
      "name": "Manager Agent Enhancement",
      "type": "implementation",
      "description": "Add dynamic staff allocation capability to Manager Agent",
      "depends_on": [],
      "parallel_safe": true,
      "priority": "P0",
      "subtasks": [
        {
          "id": "BE-11.1",
          "description": "Add allocate_staff_agents() method for dynamic staff allocation",
          "service": "backend",
          "files_to_modify": [
            "backend/src/agents/manager_agent.py"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "cd backend && pytest tests/test_manager_agent.py -v",
            "expected": "Tests pass"
          },
          "acceptance_criteria": [
            "allocate_staff_agents(task, available_staff) method",
            "Allocation based on risk level, required skills, workload",
            "Proportional allocation to task complexity",
            "Load balancing across available staff"
          ],
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-7-staff-agents",
      "name": "Staff Agent System",
      "type": "implementation",
      "description": "Create Staff Agent Factory and implement specialized staff agents with MCP integration",
      "depends_on": [
        "phase-6-manager-agent"
      ],
      "parallel_safe": true,
      "priority": "P1",
      "subtasks": [
        {
          "id": "BE-12.1",
          "description": "Create Staff Agent Factory for specialized agent spawning",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "backend/src/agents/staff_factory.py"
          ],
          "patterns_from": [
            "backend/src/agents/staff_agents.py"
          ],
          "verification": {
            "type": "command",
            "command": "cd backend && pytest tests/test_staff_factory.py -v",
            "expected": "Tests pass"
          },
          "acceptance_criteria": [
            "Factory pattern for agent creation",
            "Support for: Excel_Parser, Standard_Retriever, Vouching_Assistant, WorkPaper_Generator",
            "Type-specific agent instantiation"
          ],
          "status": "pending"
        },
        {
          "id": "BE-12.2",
          "description": "Implement Staff Agents with MCP tool integration",
          "service": "backend",
          "files_to_modify": [
            "backend/src/agents/staff_agents.py"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "cd backend && pytest tests/test_staff_agents.py -v",
            "expected": "Tests pass"
          },
          "acceptance_criteria": [
            "All 4 agent types functional",
            "MCP tool calls working (mcp-excel-processor, mcp-rag)",
            "Proper error handling for MCP failures"
          ],
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-8-langgraph",
      "name": "LangGraph Integration",
      "type": "implementation",
      "description": "Update State Definition, Main Graph, and add HITL Interrupt nodes",
      "depends_on": [],
      "parallel_safe": false,
      "priority": "P0",
      "subtasks": [
        {
          "id": "BE-14.2",
          "description": "Update State Definition with new fields for EGA and HITL",
          "service": "backend",
          "files_to_modify": [
            "backend/src/graph/state.py"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "cd backend && python -c \"from src.graph.state import AuditState; print('State import OK')\"",
            "expected": "State import OK"
          },
          "acceptance_criteria": [
            "Add interview_complete: bool field",
            "Add specification: Dict[str, Any] field",
            "Add egas: List[Dict[str, Any]] field",
            "Add urgency_config: Dict[str, Any] field",
            "Type safety maintained"
          ],
          "status": "pending"
        },
        {
          "id": "BE-14.1",
          "description": "Update Main Graph with new nodes and conditional routing",
          "service": "backend",
          "files_to_modify": [
            "backend/src/graph/graph.py"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "cd backend && python -c \"from src.graph.graph import graph; print('Graph import OK')\"",
            "expected": "Graph import OK"
          },
          "acceptance_criteria": [
            "Add interview_node to graph",
            "Add ega_parser_node to graph",
            "Add task_generator_node to graph",
            "Add urgency_node to graph",
            "Conditional routing updated",
            "Checkpointing working"
          ],
          "status": "pending"
        },
        {
          "id": "BE-14.3",
          "description": "Create HITL Interrupt Node for escalation handling",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "backend/src/graph/nodes/hitl_interrupt.py"
          ],
          "patterns_from": [
            "backend/src/graph/nodes/partner.py"
          ],
          "verification": {
            "type": "command",
            "command": "cd backend && pytest tests/test_hitl_interrupt.py -v",
            "expected": "Tests pass"
          },
          "acceptance_criteria": [
            "Trigger on urgency_score >= threshold",
            "interrupt() call for workflow pause",
            "Resume after user response",
            "hitl_requests table integration"
          ],
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-9-ega-parsing",
      "name": "EGA Parsing and Task Generation",
      "type": "implementation",
      "description": "Create EGA Parser, Task Generator, and Urgency Calculation nodes",
      "depends_on": [
        "phase-8-langgraph"
      ],
      "parallel_safe": false,
      "priority": "P0",
      "subtasks": [
        {
          "id": "BE-13.1",
          "description": "Create EGA Parser Node for extracting EGAs from Assigned Workflow documents",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "backend/src/graph/nodes/ega_parser.py"
          ],
          "patterns_from": [
            "backend/src/graph/nodes/partner.py"
          ],
          "verification": {
            "type": "command",
            "command": "cd backend && pytest tests/test_ega_parser.py -v",
            "expected": "Tests pass"
          },
          "acceptance_criteria": [
            "parse_assigned_workflow(file_path, mcp_excel_client) method",
            "audit_egas record creation",
            "Support for various Excel formats",
            "Hierarchy relationship extraction"
          ],
          "status": "pending"
        },
        {
          "id": "BE-13.2",
          "description": "Create Task Generation Node for 3-level task hierarchy from EGAs",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "backend/src/graph/nodes/task_generator.py"
          ],
          "patterns_from": [
            "backend/src/graph/nodes/partner.py"
          ],
          "verification": {
            "type": "command",
            "command": "cd backend && pytest tests/test_task_generator.py -v",
            "expected": "Tests pass"
          },
          "acceptance_criteria": [
            "3-level hierarchy: High (EGA), Mid (assertion), Low (procedure)",
            "parent_task_id linking",
            "task_level field assignment",
            "Integration with audit_tasks table"
          ],
          "status": "pending"
        },
        {
          "id": "BE-13.3",
          "description": "Create Urgency Calculation Node for task urgency scoring",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "backend/src/graph/nodes/urgency_node.py"
          ],
          "patterns_from": [
            "backend/src/graph/nodes/partner.py"
          ],
          "verification": {
            "type": "command",
            "command": "cd backend && pytest tests/test_urgency_node.py -v",
            "expected": "Tests pass"
          },
          "acceptance_criteria": [
            "Urgency score calculation (materiality 40%, risk 35%, AI confidence 25%)",
            "urgency_score assignment to all tasks",
            "Threshold-based HITL escalation trigger"
          ],
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-10-api-endpoints",
      "name": "API Endpoints",
      "type": "implementation",
      "description": "Add Project, EGA, and HITL REST API endpoints",
      "depends_on": [
        "phase-8-langgraph"
      ],
      "parallel_safe": true,
      "priority": "P1",
      "subtasks": [
        {
          "id": "BE-15.1",
          "description": "Add Project CRUD endpoints",
          "service": "backend",
          "files_to_modify": [
            "backend/src/api/routes.py"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "api",
            "method": "GET",
            "url": "http://localhost:8000/api/projects",
            "expected_status": 200
          },
          "acceptance_criteria": [
            "POST /api/projects - Create project",
            "GET /api/projects - List projects",
            "GET /api/projects/{id} - Get project details",
            "Pydantic validation"
          ],
          "status": "pending"
        },
        {
          "id": "BE-15.2",
          "description": "Add EGA endpoints for parsing and listing",
          "service": "backend",
          "files_to_modify": [
            "backend/src/api/routes.py"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "api",
            "method": "GET",
            "url": "http://localhost:8000/api/projects/test-id/egas",
            "expected_status": 200
          },
          "acceptance_criteria": [
            "POST /api/projects/{id}/egas/parse - Parse Assigned Workflow",
            "GET /api/projects/{id}/egas - List EGAs",
            "File upload handling"
          ],
          "status": "pending"
        },
        {
          "id": "BE-15.3",
          "description": "Add HITL queue management endpoints",
          "service": "backend",
          "files_to_modify": [
            "backend/src/api/routes.py"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "api",
            "method": "GET",
            "url": "http://localhost:8000/api/hitl/pending",
            "expected_status": 200
          },
          "acceptance_criteria": [
            "GET /api/hitl/pending - List pending requests",
            "POST /api/hitl/{id}/respond - Submit response",
            "Graph resume after response"
          ],
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-11-integration",
      "name": "Integration Testing",
      "type": "integration",
      "description": "End-to-end verification of all components working together",
      "depends_on": [
        "phase-1-project-ui",
        "phase-2-streaming",
        "phase-3-ega-task-ui",
        "phase-4-hitl-ui",
        "phase-9-ega-parsing",
        "phase-10-api-endpoints"
      ],
      "parallel_safe": false,
      "priority": "P0",
      "subtasks": [
        {
          "id": "INT-1",
          "description": "Integration test: Project CRUD flow (frontend \u2194 backend \u2194 Supabase)",
          "all_services": true,
          "files_to_modify": [],
          "files_to_create": [
            "frontend/e2e/project-crud.spec.ts"
          ],
          "patterns_from": [
            "frontend/e2e/02-project-creation.spec.ts"
          ],
          "verification": {
            "type": "e2e",
            "steps": [
              "Create project via UI",
              "Verify project appears in dropdown",
              "Select project",
              "Verify selection persists on refresh"
            ]
          },
          "status": "pending"
        },
        {
          "id": "INT-2",
          "description": "Integration test: Agent streaming flow (frontend \u2194 backend SSE)",
          "all_services": true,
          "files_to_modify": [],
          "files_to_create": [
            "frontend/e2e/agent-streaming.spec.ts"
          ],
          "patterns_from": [
            "frontend/e2e/05-sse-streaming.spec.ts"
          ],
          "verification": {
            "type": "e2e",
            "steps": [
              "Start task with SSE streaming",
              "Verify messages stream in real-time",
              "Test reconnection on disconnect",
              "Verify agent role indicators"
            ]
          },
          "status": "pending"
        },
        {
          "id": "INT-3",
          "description": "Integration test: HITL workflow (frontend \u2194 backend \u2194 LangGraph)",
          "all_services": true,
          "files_to_modify": [],
          "files_to_create": [
            "frontend/e2e/hitl-workflow.spec.ts"
          ],
          "patterns_from": [
            "frontend/e2e/03-task-approval.spec.ts"
          ],
          "verification": {
            "type": "e2e",
            "steps": [
              "Trigger HITL request via high urgency task",
              "Verify request appears in queue",
              "Submit approval response",
              "Verify workflow resumes"
            ]
          },
          "status": "pending"
        }
      ]
    }
  ],
  "summary": {
    "total_phases": 11,
    "total_subtasks": 28,
    "services_involved": [
      "frontend",
      "backend"
    ],
    "parallelism": {
      "max_parallel_phases": 6,
      "parallel_groups": [
        {
          "phases": [
            "phase-1-project-ui",
            "phase-2-streaming",
            "phase-5-partner-agent",
            "phase-6-manager-agent",
            "phase-8-langgraph"
          ],
          "reason": "No dependencies, different file sets, can run simultaneously"
        },
        {
          "phases": [
            "phase-3-ega-task-ui",
            "phase-4-hitl-ui"
          ],
          "reason": "Both depend on phase-1, but different file sets"
        },
        {
          "phases": [
            "phase-7-staff-agents",
            "phase-9-ega-parsing",
            "phase-10-api-endpoints"
          ],
          "reason": "All depend on earlier phases completing"
        }
      ],
      "recommended_workers": 2,
      "speedup_estimate": "2x faster than sequential execution"
    },
    "critical_path": [
      "phase-8-langgraph (BE-14.2 State Definition)",
      "phase-9-ega-parsing (BE-13.1-13.3 Parser/Generator/Urgency)",
      "phase-10-api-endpoints (BE-15.1-15.3 REST APIs)",
      "phase-11-integration (INT-1-3 E2E Tests)"
    ],
    "startup_command": "source auto-claude/.venv/bin/activate && python auto-claude/run.py --spec 001-claude-md --parallel 2"
  },
  "verification_strategy": {
    "risk_level": "high",
    "skip_validation": false,
    "test_creation_phase": "during_implementation",
    "test_types_required": [
      "unit",
      "integration",
      "e2e"
    ],
    "security_scanning_required": true,
    "staging_deployment_required": false,
    "acceptance_criteria": [
      "All existing tests pass",
      "New code has test coverage",
      "No security vulnerabilities detected",
      "No TypeScript/Python type errors",
      "No console errors in browser"
    ],
    "verification_steps": [
      {
        "name": "Frontend Unit Tests",
        "command": "cd frontend && npm test -- --run",
        "expected_outcome": "All tests pass",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "Backend Unit Tests",
        "command": "cd backend && pytest tests/ -v",
        "expected_outcome": "All tests pass",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "Frontend Type Check",
        "command": "cd frontend && npm run typecheck 2>/dev/null || npx tsc --noEmit",
        "expected_outcome": "No type errors",
        "type": "lint",
        "required": true,
        "blocking": true
      },
      {
        "name": "E2E Tests",
        "command": "cd frontend && npm run test:e2e",
        "expected_outcome": "All E2E tests pass",
        "type": "e2e",
        "required": true,
        "blocking": true
      }
    ],
    "reasoning": "High-risk multi-agent system with complex orchestration requires comprehensive testing."
  },
  "qa_acceptance": {
    "unit_tests": {
      "required": true,
      "commands": [
        "cd frontend && npm test -- --run",
        "cd backend && pytest tests/ -v"
      ],
      "minimum_coverage": null
    },
    "integration_tests": {
      "required": true,
      "commands": [
        "cd frontend && npm run test:e2e"
      ],
      "services_to_test": [
        "frontend",
        "backend"
      ]
    },
    "e2e_tests": {
      "required": true,
      "commands": [
        "cd frontend && npx playwright test"
      ],
      "flows": [
        "project-crud",
        "agent-streaming",
        "hitl-workflow"
      ]
    },
    "browser_verification": {
      "required": true,
      "pages": [
        {
          "url": "http://localhost:3000",
          "checks": [
            "renders",
            "no-console-errors",
            "ProjectSelector visible"
          ]
        },
        {
          "url": "http://localhost:3000/workspace/egas",
          "checks": [
            "EGA list renders",
            "risk badges visible"
          ]
        },
        {
          "url": "http://localhost:3000/workspace/tasks",
          "checks": [
            "task tree renders",
            "expand/collapse works"
          ]
        },
        {
          "url": "http://localhost:3000/workspace/hitl",
          "checks": [
            "HITL queue renders",
            "urgency sorting works"
          ]
        }
      ]
    },
    "api_verification": {
      "required": true,
      "endpoints": [
        {
          "method": "GET",
          "url": "/api/projects",
          "expected_status": 200
        },
        {
          "method": "GET",
          "url": "/api/hitl/pending",
          "expected_status": 200
        }
      ]
    }
  },
  "qa_signoff": null,
  "last_updated": "2026-01-08T08:14:54.708040+00:00"
}